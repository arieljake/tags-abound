var dao = require('listly').submissionDAO;
var mongo = require("mongodb");

exports.getAllSubmissions = function (db)
{
	return function (req,res)
	{
		dao.findAllSubmissions(db,function(items)
		{
			res.send(items);
		});
	};
};

exports.getSubmissionById = function (db,idParamName)
{
	return function (req,res)
	{
		var submissionId = new mongo.ObjectID(req.params[idParamName]);

		dao.findSubmissionById(db,submissionId,function(item)
		{
			res.send(item);
		});
	};
};

exports.getSubmissionListsById = function (db,idParamName)
{
	return function (req,res)
	{
		var submissionId = new mongo.ObjectID(req.params[idParamName]);

		dao.findSubmissionListsById(db,submissionId,function (lists)
		{
			res.send(lists);
		});
	};
};

exports.getSubmissionsByTitle = function (db,titleParamName)
{
	return function (req,res)
	{
		var title = req.params[titleParamName];

		dao.findSubmissionsByTitle(db,title,function(items)
		{
			res.send(items);
		});
	};
};

exports.saveSubmission = function (db)
{
	return function (req,res)
	{
		var submission = req.body;
		var id = submission._id ? new mongo.ObjectID(submission._id) : undefined;

		submission.username = req.session.username;

		if (id === undefined)
		{
			dao.createSubmission(db,submission,function(submission)
			{
				res.send(submission);
			});
		}
		else
		{
			dao.updateSubmission(db,id,submission,function(submission)
			{
				res.send(submission);
			});
		}
	};
};