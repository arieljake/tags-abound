
var listly = require('listly');

var SubmissionRoutes = module.exports.SubmissionRoutes = function (listlyServer)
{
	this.submissionDAO = listlyServer.submissionDAO;
};

SubmissionRoutes.prototype.home = function(req, res)
{
	this.submissionDAO.findAllSubmissions(function (err,submissions)
	{
		if (err !== null || submissions === null)
		{
			res.writeHead(404);
			res.end("an error occurred");
		}
		else
		{
			res.render('submissions/home/index', listly.renderUtils.params(req,{title: "Submissions", submissions: submissions}));
		}
	});
};

SubmissionRoutes.prototype.detail = function (submissionIdParam)
{
	var self = this;

	return function (req,res)
	{
		var submissionId = req.params[submissionIdParam];

		self.submissionDAO.findSubmissionById(submissionId, function (err,submission)
		{
			if (err !== null || submission === null)
			{
				res.writeHead(404);
				res.end("that submission does not exist");
			}
			else
			{
				res.render('submissions/detail/index', listly.renderUtils.params(req,{title: "Submission", submission: submission}));
			}
		});
	};
};