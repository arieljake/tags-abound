
var listly = require('listly');
var json = require('json');

var UtilRoutes = module.exports.UtilRoutes = function (listlyServer)
{
	this.listlySocketServer = listlyServer.listlySocketServer;
	this.listlyEmailService = listlyServer.listlyEmailService;
	this.mapReduceService = listlyServer.mapReduceService;
};

UtilRoutes.prototype.doPing = function (req,res)
{
	this.listlySocketServer.logMsg('ping successful');
	this.listlyEmailService.sendMessage("arieljake@yahoo.com","Ping!","ping successful");

	res.send('ping successful');
};

UtilRoutes.prototype.viewLogger = function(req,res)
{
	res.render('socket/logger',{layout: false, title: "Logger"});
};

UtilRoutes.prototype.performMapReduce = function(req,res)
{
	var self = this;

	res.writeHead(200);

	this.mapReduceService.performMapReduce(function (results)
	{
		var output = json.stringify(results);
		res.write(output);
		self.listlySocketServer.logMsg(output);

	}, function ()
	{
		res.end();
	});
};