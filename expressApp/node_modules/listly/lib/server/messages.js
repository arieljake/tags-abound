
var json = require('json');

var ListlyMessageService = module.exports.ListlyMessageService = function (messageProvider)
{
	var self = this;

	this.messageProvider = messageProvider;
};

ListlyMessageService.prototype.createEmptyMessage = function ()
{
	return {
		timestamp: (new Date()).toUTCString()
	};
};

ListlyMessageService.prototype.putMessage = function (queueName, msgObj)
{
	this.messageProvider.putMessage(queueName,json.stringify(msgObj));
};

ListlyMessageService.prototype.handleNewSubmission = function (submission)
{
	var msg = this.createEmptyMessage();
	msg.userId = submission.userId;
	msg.submissionId = submission._id;

	this.putMessage("newSubmissions",msg);
};

ListlyMessageService.prototype.logError = function (error)
{
	var msg = this.createEmptyMessage();
	msg.text = error;

	this.putMessage("errors",msg);
};