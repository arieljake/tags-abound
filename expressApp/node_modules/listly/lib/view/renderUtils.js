var underscore = require('underscore');
var json = require('json');
var listly = require('listly');

module.exports.params = function (req,overrides)
{
	var username = listly.session.getCurrentUsername(req);
	var baseDataUrl = "http://localhost:3001";

	var defaultProperties = {
		username: username,
		baseDataUrl: baseDataUrl,
		noMenu: false,
		ngApp: undefined
	};

	return underscore.extend(defaultProperties, overrides);
};


var outputJSONP = module.exports.outputJSONP = function (req,obj)
{
	var callback = req.query.callback;
	var output = json.stringify(obj);
	// var protectedOutput = ")]}',\n" + output;
	var jsonpOutput;

	if (callback !== undefined)
		jsonpOutput = callback + "(" + output + ")";
	else
		jsonpOutput = output;

	return jsonpOutput;
};

var resultJSONP = module.exports.resultJSONP = function (req,res,obj)
{
	res.writeHead(200,{
		"Content-Type": "application/json"
	});
	res.end(outputJSONP(req,obj));
};